<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tomographer: Tomorun and custom figures of merit</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="tomographer_extra_css.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Tomographer
   &#160;<span id="projectnumber">v5.2</span>
   </div>
   <div id="projectbrief">Tomographer C++ Framework Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_tomorun_new_figure_of_merit.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tomorun and custom figures of merit </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>tomorun</code> executable has several figures of merit built into the program: the trace distance, the purified distance, or the fidelity to any reference state, as well as the expectation value of an observable. If you wish to produce a histogram of a different figure of merit which can't be cast into one of these, you have the following options.</p>
<p>I. Use the Python module, which allows you to specify any custom figure of merit given as a Python callable;</p>
<p>II. Write a small, special-purpose C++ program which does exactly what you need, in which you can code your custom figure of merit;</p>
<p>III. Modify the source of the <code>tomorun</code> program itself, to add your new figure of merit.</p>
<p>Option I is the simplest, and should be your default choice; options II and III require a bit more work.</p>
<p>Option II may be easier if you have a very special purpose which might not warrant inclusion into the generic <code>tomorun</code> program. You can simply combine the required tools into a new special-purpose program. This is not difficult, and there are already examples ready&mdash;see <a class="el" href="page_custom_tomorun_exe.html">Creating a custom tomorun-like program</a>.</p>
<p>In the following we describe the necessary steps for Option III.</p>
<dl class="section note"><dt>Note</dt><dd>If you perform modifications which may be useful to others, please <b>fork the repository on github</b>, perform your changes, and send me a pull request. This way your changes will be availble to other users who would like to use the Tomographer project. Please see <a href="https://github.com/Tomographer/tomographer/blob/master/README.md#contributing">here</a> for information on how to contribute.</dd></dl>
<p>We'll illustrate these steps with a simple example: the two-norm distance (aka. the Hilbert-Schmidt distance) to any reference state, defined by \( d_\mathrm{HS}(\rho,\rho_{\mathrm{Ref}}) = \Vert \rho-\rho_{\mathrm{Ref}}\Vert_2 \), with \( \Vert A\Vert_2 = \mathrm{tr}\left(A^\dagger A\right) \).</p>
<h2>1. Code how to calculate your figure of merit</h2>
<p>First, you should write the code which calculates the figure of merit, complying to a <a class="el" href="page_interface_value_calculator.html">ValueCalculator Interface</a> type interface. Your new class should in particular have a method <code>getValue(const MatrixType &amp; T)</code> taking as argument an <a href="http://eigen.tuxfamily.org/dox/group__TutorialMatrixClass.html">Eigen matrix type</a> which will be a matrix square root (see <a class="el" href="page_params_t.html"><em>T</em> Parameterization</a>) of the quantum state <em>rho</em> for which the function should calculate the figure of merit.</p>
<p>You should do this in a new header file, that's the easiest.</p>
<p>For our example, we can get inspired by the code for, e.g., <a class="el" href="class_tomographer_1_1_dense_d_m_1_1_t_space_1_1_tr_dist_to_ref_calculator.html">Tomographer::DenseDM::TSpace::TrDistToRefCalculator</a> defined in <a class="el" href="tspacefigofmerit_8h.html">tspacefigofmerit.h</a>. For example, let's create a file called <code>"hs_dist.h"</code> inside the <code>"tomorun/"</code> directory of the tomographer project:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef HS_DIST_H</span></div><div class="line"><span class="preprocessor">#define HS_DIST_H</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;Eigen/Eigen&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="needownoperatornew_8h.html">tomographer/tools/needownoperatornew.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dmtypes_8h.html">tomographer/densedm/dmtypes.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> DMTypes_, <span class="keyword">typename</span> ValueType_ = <span class="keywordtype">double</span>&gt;</div><div class="line"><span class="keyword">class </span>HSDistToRefCalculator</div><div class="line">  : <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="struct_tomographer_1_1_tools_1_1_need_own_operator_new.html">Tomographer::Tools::NeedOwnOperatorNew</a>&lt;typename DMTypes_::MatrixType&gt;::ProviderType</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="keyword">typedef</span> DMTypes_ DMTypes;</div><div class="line">  <span class="comment">// this is the type to use to store a dense (dim x dim) matrix:</span></div><div class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> DMTypes::MatrixType MatrixType;</div><div class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> DMTypes::MatrixTypeConstRef MatrixTypeConstRef;</div><div class="line"></div><div class="line">  <span class="comment">// For the ValueCalculator interface: the value type</span></div><div class="line">  <span class="keyword">typedef</span> ValueType_ ValueType;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <span class="keyword">const</span> MatrixType rho_ref;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="comment">// Constructor, the reference state is &#39;rho_ref&#39;</span></div><div class="line">  TrDistToRefCalculator(MatrixTypeConstRef rho_ref_)</div><div class="line">    : rho_ref(rho_ref_)</div><div class="line">  {</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// This method actually calculates the given value.  The argument &quot;T&quot; is</span></div><div class="line">  <span class="comment">// the T-parameterization of the density matrix rho, which is simply a</span></div><div class="line">  <span class="comment">// square root of rho. (This is indeed the representation used during the</span></div><div class="line">  <span class="comment">// random walk.)</span></div><div class="line">  <span class="keyword">inline</span> ValueType getValue(MatrixTypeConstRef T)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    <span class="comment">// rho is obtained with T*T.adjoint().  With Eigen, the HS-norm (Frobenius) of a</span></div><div class="line">    <span class="comment">// matrix is given by A.norm().</span></div><div class="line">    <span class="keywordflow">return</span> (T*T.adjoint() - rho_ref).norm();</div><div class="line">  }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="preprocessor">#endif // HS_DIST_H</span></div></div><!-- fragment --><p>The part about <a class="el" href="needownoperatornew_8h.html">needownoperatornew.h</a> and <a class="el" href="struct_tomographer_1_1_tools_1_1_need_own_operator_new.html">Tomographer::Tools::NeedOwnOperatorNew</a> is to make sure that the object, when created, is aligned in memory. This is needed because the object has a Eigen member (<em>rho_ref</em>) which must be aligned in memory for vectorized operations (see Eigen's docs for alignment issues, there's a lot on that). In the <a class="el" href="namespace_tomographer.html" title="Base namespace for the Tomographer project. ">Tomographer</a> project, the <a class="el" href="struct_tomographer_1_1_tools_1_1_need_own_operator_new.html">Tomographer::Tools::NeedOwnOperatorNew</a> virtual base makes sure that the necessary <code>operator new()</code> is defined so that objects are aligned in memory when allocated.</p>
<h2>2. Integrate the new figure of merit into the <code>tomorun</code> program</h2>
<p>In order to integrate a new figure of merit into the <code>tomorun</code> program, one simply has to declare it in the <code>"tomorun/tomorun_figofmerit.h"</code> header file.</p>
<p>All you have to do is (1) Write a class which describes how to create the value calculator for this figure of merit, what help text to display, and the option name; and (2) add this class to the list of known figures of merit (at the bottom of the file).</p>
<p>For (1), in our example, we might define the class <em>HsDistFigureOfMerit</em> as follows. (Also, we need to add <code>#include "hs_dist.h"</code> at the top of the file.)</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>HsDistFigureOfMerit</div><div class="line">{</div><div class="line">  <span class="comment">// The name of the figure merit for the --value-type option: here, --value-type=&quot;HS-dist&quot;</span></div><div class="line">  <span class="keyword">const</span> <a class="codeRef" doxygen="/Users/philippe/Research/projects/tomographer/doc/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> name{<span class="stringliteral">&quot;HS-dist&quot;</span>};</div><div class="line"></div><div class="line">  <span class="comment">// The ValueCalculator class we need to use, for the given DMTypes</span></div><div class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> DMTypes&gt; <span class="keyword">using</span> ValueCalculator = HSDistToRefCalculator&lt;DMTypes,TomorunReal&gt;;</div><div class="line"></div><div class="line">  <span class="comment">// The code which instanciates a new ValueCalculator with the appropriate input data</span></div><div class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> DMTypes&gt;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">inline</span> ValueCalculator&lt;DMTypes&gt; *</div><div class="line">  createValueCalculator(DMTypes dmt, <span class="keyword">const</span> <a class="codeRef" doxygen="/Users/philippe/Research/projects/tomographer/doc/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> &amp; ref_obj_name, <a class="code" href="class_tomographer_1_1_m_a_t_1_1_file.html">Tomographer::MAT::File</a> * matf)</div><div class="line">  {</div><div class="line">    <span class="comment">// create the value calculator</span></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> ValueCalculator&lt;DMTypes&gt;(read_ref_state_rho&lt;DMTypes&gt;(matf, ref_obj_name)) ; </div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Print some help text to the screen when queried with --help. We can insert footnotes</span></div><div class="line">  <span class="comment">// using footnotes.addFootNote(...)</span></div><div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> print(<a class="codeRef" doxygen="/Users/philippe/Research/projects/tomographer/doc/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::ostream</a> &amp; stream, <a class="code" href="class_tomographer_1_1_tools_1_1_fmt_footnotes.html">Tomographer::Tools::FmtFootnotes</a> &amp; footnotes) {</div><div class="line">    stream &lt;&lt;</div><div class="line">      <span class="stringliteral">&quot;The Hilbert-Schmidt distance to a reference state &quot;</span></div><div class="line">      &lt;&lt; footnotes.addFootNote(</div><div class="line">          <span class="stringliteral">&quot;The Hilbert-Schmidt distance is computed as d_{HS}(rho,sigma) = &quot;</span></div><div class="line">          <span class="stringliteral">&quot;tr( (rho - sigma)^\\dagger (rho - sigma) ).&quot;</span></div><div class="line">          )</div><div class="line">      &lt;&lt; <span class="stringliteral">&quot;. &lt;RefObject&gt; should be the name of a MATLAB variable present in the &quot;</span></div><div class="line">      <span class="stringliteral">&quot;MATLAB data file. This object should be a complex dim x dim matrix, the &quot;</span></div><div class="line">      <span class="stringliteral">&quot;density matrix of the reference state. If no &lt;RefObject&gt; is specified, &quot;</span></div><div class="line">      <span class="stringliteral">&quot;then &#39;rho_ref&#39; is used.&quot;</span></div><div class="line">      ;</div><div class="line">  }</div><div class="line">};</div></div><!-- fragment --><p>Finally, for (2), you have to insert your class name (here <em>HsDistFigureOfMerit</em>) into the <em>TomorunFiguresOfMerit</em> tuple at the bottom of the file, in order to make the program aware of this new figure of merit.</p>
<p>Recompile <em>tomorun</em> (and fix any build issues etc.). You may now use your custom figure of merit with the option <code>"--value-type=HS-dist"</code> or <code>"--value-type=HS-dist:varname"</code>. Notice that it also appears in the help text when you run <code>"tomorun --help"</code> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!--
 * This file is part of the Tomographer project, which is distributed under the
 * terms of the MIT license.
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2016 ETH Zurich, Institute for Theoretical Physics, Philippe Faist
 * Copyright (c) 2017 Caltech, Institute for Quantum Information and Matter, Philippe Faist
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">%Tomographer C++ Framework: API Documentation</a></li><li class="navelem"><a class="el" href="page_tomorun.html">Tomorun &mdash; Standalone Executable</a></li>
    <li class="footer">Generated on Tue Aug 22 2017 11:06:26 for Tomographer by
    <a href="http://www.doxygen.org/index.html">
    Doxygen 1.8.12</a> </li>
  </ul>
</div>
<!-- and now, plug in our script to tweak the page: -->
<script type="text/javascript" src="tomographer_script_setup.js"></script>
</body>
</html>
